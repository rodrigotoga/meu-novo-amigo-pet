{% extends 'base/base.html' %}
{% load static %}

{% block title %}{% if object %}Editar Pet{% else %}Cadastrar Pet{% endif %} - Meu Novo Amigo Pet{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">
                        <i class="fas fa-paw me-2"></i>
                        {% if object %}Editar Pet{% else %}Cadastrar Novo Pet{% endif %}
                    </h3>
                </div>
                <div class="card-body p-4">
                    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <!-- Informações Básicas -->
                        <div class="mb-4">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-info-circle me-2"></i>Informações Básicas
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.nome.id_for_label }}" class="form-label">Nome do Pet *</label>
                                    {{ form.nome }}
                                    <div class="invalid-feedback">
                                        Por favor, informe o nome do pet.
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.especie.id_for_label }}" class="form-label">Espécie *</label>
                                    {{ form.especie }}
                                    <div class="invalid-feedback">
                                        Por favor, selecione a espécie.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.porte.id_for_label }}" class="form-label">Porte *</label>
                                    {{ form.porte }}
                                    <div class="invalid-feedback">
                                        Por favor, selecione o porte.
                                    </div>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.sexo.id_for_label }}" class="form-label">Sexo *</label>
                                    {{ form.sexo }}
                                    <div class="invalid-feedback">
                                        Por favor, selecione o sexo.
                                    </div>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.idade_meses.id_for_label }}" class="form-label">Idade (meses) *</label>
                                    {{ form.idade_meses }}
                                    <div class="invalid-feedback">
                                        Por favor, informe a idade em meses.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Localização -->
                        <div class="mb-4">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-map-marker-alt me-2"></i>Localização
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label for="{{ form.cidade.id_for_label }}" class="form-label">Cidade *</label>
                                    {{ form.cidade }}
                                    <div class="invalid-feedback">
                                        Por favor, informe a cidade.
                                    </div>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.estado.id_for_label }}" class="form-label">Estado *</label>
                                    {{ form.estado }}
                                    <div class="invalid-feedback">
                                        Por favor, selecione o estado.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Descrição -->
                        <div class="mb-4">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-file-alt me-2"></i>Descrição
                            </h5>
                            
                            <div class="mb-3">
                                <label for="{{ form.descricao.id_for_label }}" class="form-label">Descrição do Pet *</label>
                                {{ form.descricao }}
                                <div class="form-text">Descreva a personalidade, comportamento e características do pet.</div>
                                <div class="invalid-feedback">
                                    Por favor, forneça uma descrição do pet.
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.historia.id_for_label }}" class="form-label">História</label>
                                {{ form.historia }}
                                <div class="form-text">Conte como o pet foi resgatado ou encontrado (opcional).</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.informacoes_saude.id_for_label }}" class="form-label">Informações de Saúde</label>
                                {{ form.informacoes_saude }}
                                <div class="form-text">Vacinas, castração, problemas de saúde, etc. (opcional).</div>
                            </div>
                        </div>
                        
                        <!-- Fotos -->
                        <div class="mb-4">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-camera me-2"></i>Fotos do Pet
                            </h5>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Dica:</strong> Você pode adicionar fotos após salvar o pet. Fotos ajudam muito na adoção!
                            </div>
                        </div>
                        
                        <!-- Informações sobre Moderação -->
                        {% if not user.is_ong_verificada %}
                        <div class="mb-4">
                            <div class="alert alert-warning">
                                <i class="fas fa-clock me-2"></i>
                                <strong>Atenção:</strong> Seu anúncio será analisado por nossa equipe antes de ser publicado. 
                                ONGs verificadas têm aprovação automática.
                            </div>
                        </div>
                        {% else %}
                        <div class="mb-4">
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                <strong>ONG Verificada:</strong> Seu anúncio será aprovado automaticamente!
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Botões -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>
                                {% if object %}Atualizar Pet{% else %}Cadastrar Pet{% endif %}
                            </button>
                            
                            <a href="{% url 'pets:meus_pets' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Cancelar
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Validação do formulário
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();

// Validação da idade
document.getElementById('{{ form.idade_meses.id_for_label }}').addEventListener('input', function() {
    const idade = parseInt(this.value);
    if (idade > 300) { // 25 anos em meses
        this.setCustomValidity('A idade não pode ser superior a 25 anos.');
    } else {
        this.setCustomValidity('');
    }
});
</script>
{% endblock %}
